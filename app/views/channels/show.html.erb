<div id="infos_for_messages_and_notifications">
  <div id="current_user_id">
    <%= current_user.id %>
  </div>
  <div id="unread_messages_nbr">
    <%= current_user.total_unread_messages_nbr.to_f %>
  </div>
</div>
<div class="wrapper-messenger">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2">
        <p><%= link_to "Create a new channel", new_channel_path %></p>
        <h3><%= @channel.default_name(current_user) %></h3>
        <% if @channel.one_to_one? || @admin %>
          <%= link_to "edit", edit_channel_path(@channel) %>
        <% end %>
        <ul>
          <% @subscriptions.each do |subscription| %>
            <% if !current_user?(subscription.user) %>
              <li><%= subscription.user.alias %></li>
            <% end %>
          <% end %>
        </ul>
        <ul>
          <% current_user.channels.each do |channel| %>
            <li>
              <% if current_user.unread_messages_nbr(channel) && (channel.messages.last.id != current_user.messages.last.id) %>
              <div class="unread">
                <%= link_to channel.default_name(current_user), channel %>
              </div>
              <% elsif (channel == @channel) %>
              <div>
                <%= link_to channel.default_name(current_user), channel %>
              </div>
              <% else %>
              <div id="unread-channel-<%= channel.id %>">
                <%= link_to channel.default_name(current_user), channel %>
              </div>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
      <div class="col-md-10">
        <ul id="messages-table">
          <% @channel.messages.each_with_index do |message, index| %>
            <% if index == @new_messages_limit %> <!-- need to be done with action cable too -->
              New message <hr>
            <% end %>
            <li id="message-container">
              <div id="message-infos">
                <h1><%= message.user.alias %></h1>
                <p> | <%= message.updated_at.strftime("%d/%m/%y Ã  %Hh%M")%></p>
              </div>
              <p><%= message.content %></p>
            </li>
            <div id="delete-btn">
              <% if current_user?(message.user) %>
                  <%= link_to "delete", [@channel, message], method: :delete, data: {confirm: "Are you sure! Do you want delete this post"}  %>
              <% end %>
            </div>
          <% end %>
        </ul>
        <%= simple_form_for [@channel, @message], remote: true do |f| %>
          <%= f.input :content, label: false %>
          <%= f.button :submit, 'Send', id:"submit-btn" %>
        <% end %>
      </div>
    </div>
  </div>
</div>
